name: Suggest A Tip
run-name: How much do you want to tip ${{ github.actor }}?
on: [pull_request]
jobs:
  suggest_tips:
    permissions:
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: |
          sponsor_status=$(curl -o /dev/null -s -w "%{http_code}" -I -L https://github.com/sponsors/${{ github.actor }})
          if [ "$sponsor_status" -eq 200 ]; then
            echo "URL does not redirect, workflow succeeds."
          else
            echo "URL redirects, workflow fails."
            exit 1
          fi
      - name: Count changed lines
        id: count-lines
        if: success()
        run: |
          commit_range=$(git log -1 --pretty=format:"%T...%H")
          changed_lines=$(git diff --unified=0 $commit_range | grep -e '^[+-]' | wc -l)
          echo "CHANGED_LINES=$changed_lines" >> $GITHUB_ENV
      - name: Count Lines of Code (cloc)
        if: success()
        uses: djdefi/cloc-action@6
      - name: Comment PR
        if: success()
        uses: thollander/actions-comment-pull-request@v2
        with:
          message: |
            Hello there testing! :wave: ${{ env.CHANGED_LINES }}
      - run: echo "Awesome!"
        if: always()
            
            
